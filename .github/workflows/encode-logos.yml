name: Encode Logo Vault

# Manual trigger only ‚Äî run this ONCE after your PNGs are good on GitHub
on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  encode:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Node
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Validate PNGs exist and are valid
        run: |
          for f in public/logo192.png public/logo512.png; do
            if [ ! -f "$f" ]; then
              echo "‚ùå $f not found!"
              exit 1
            fi
            HEADER=$(xxd -l 4 -p "$f")
            if [ "$HEADER" != "89504e47" ]; then
              echo "‚ùå $f is NOT a valid PNG (header: $HEADER)"
              echo "   Fix the PNGs on GitHub first, then re-run this workflow."
              exit 1
            fi
            echo "‚úÖ $f is a valid PNG"
          done

      - name: Encode PNGs to vault
        run: node scripts/encode-logos.mjs

      - name: Commit vault
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add scripts/logo-vault.json
          git diff --cached --quiet && echo "No changes to commit" || git commit -m "üîí Encode logo vault from verified PNGs"
          git push
